<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ªû ƒë√¢y c√≥ s·ª± b√¨nh y√™n - S·ª©c Kh·ªèe T√¢m Th·∫ßn cho Th·∫ø H·ªá Z</title>
    <!-- Th√™m Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Th√™m Font Awesome cho c√°c bi·ªÉu t∆∞·ª£ng -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen flex flex-col items-center justify-center p-4">
    <main class="bg-white bg-opacity-10 backdrop-filter backdrop-blur-lg rounded-3xl shadow-2xl p-8 max-w-4xl w-full relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-pink-300 via-purple-300 to-indigo-300 opacity-30 z-0"></div>
        <div class="relative z-10">
            <button id="backButton" class="absolute top-4 left-4 bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-bold py-3 px-6 rounded-full transition-all duration-300 hidden transform hover:scale-105 shadow-lg hover:shadow-xl active:scale-95 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50">
                <i class="fas fa-arrow-left mr-2"></i>Quay l·∫°i
            </button>
            <h1 class="text-5xl font-bold text-center mb-8 text-white animate-pulse">·ªû ƒë√¢y c√≥ s·ª± b√¨nh y√™n</h1>
            <p class="text-2xl text-center mb-12 text-white">H√¥m nay b·∫°n c·∫£m th·∫•y th·∫ø n√†o?</p>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-6" id="emoteButtons">
                <!-- N√∫t c·∫£m x√∫c -->
                <button class="emote-btn bg-gradient-to-br from-yellow-300 to-yellow-500 hover:from-yellow-400 hover:to-yellow-600 transition-all duration-300 rounded-2xl transform hover:scale-105 hover:rotate-3" aria-label="Vui v·∫ª" data-emote="happy">
                    <div class="w-full h-32 flex items-center justify-center text-6xl text-white">
                        <i class="fas fa-smile animate-bounce"></i>
                    </div>
                    <span class="block py-2 text-lg font-semibold text-white">Vui v·∫ª</span>
                </button>
                <button class="emote-btn bg-gradient-to-br from-blue-300 to-blue-500 hover:from-blue-400 hover:to-blue-600 transition-all duration-300 rounded-2xl transform hover:scale-105 hover:rotate-3" aria-label="Bu·ªìn" data-emote="sad">
                    <div class="w-full h-32 flex items-center justify-center text-6xl text-white">
                        <i class="fas fa-sad-tear animate-pulse"></i>
                    </div>
                    <span class="block py-2 text-lg font-semibold text-white">Bu·ªìn</span>
                </button>
                <button class="emote-btn bg-gradient-to-br from-red-300 to-red-500 hover:from-red-400 hover:to-red-600 transition-all duration-300 rounded-2xl transform hover:scale-105 hover:rotate-3" aria-label="T·ª©c gi·∫≠n" data-emote="angry">
                    <div class="w-full h-32 flex items-center justify-center text-6xl text-white">
                        <i class="fas fa-angry animate-ping"></i>
                    </div>
                    <span class="block py-2 text-lg font-semibold text-white">T·ª©c gi·∫≠n</span>
                </button>
                <button class="emote-btn bg-gradient-to-br from-purple-300 to-purple-500 hover:from-purple-400 hover:to-purple-600 transition-all duration-300 rounded-2xl transform hover:scale-105 hover:rotate-3" aria-label="S·ª£ h√£i" data-emote="scared">
                    <div class="w-full h-32 flex items-center justify-center text-6xl text-white">
                        <i class="fas fa-flushed animate-spin"></i>
                    </div>
                    <span class="block py-2 text-lg font-semibold text-white">S·ª£ h√£i</span>
                </button>
                <button class="emote-btn bg-gradient-to-br from-green-300 to-green-500 hover:from-green-400 hover:to-green-600 transition-all duration-300 rounded-2xl transform hover:scale-105 hover:rotate-3" aria-label="CƒÉng th·∫≥ng" data-emote="stressed">
                    <div class="w-full h-32 flex items-center justify-center text-6xl text-white">
                        <i class="fas fa-tired animate-pulse"></i>
                    </div>
                    <span class="block py-2 text-lg font-semibold text-white">CƒÉng th·∫≥ng</span>
                </button>
            </div>

            <div id="emotePage" class="hidden mt-12">
                <h2 id="emoteTitle" class="text-4xl font-bold text-center mb-8 text-white animate-pulse"></h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ph·∫ßn t·∫°o b√†i vi·∫øt tr√™n di·ªÖn ƒë√†n -->
                    <div id="forumSection" class="bg-white bg-opacity-20 rounded-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-white">H√£y chia s·∫ª </h3>
                        <form id="forumForm" class="space-y-4">
                            <textarea id="forumContent" class="w-full h-32 p-2 rounded-lg" placeholder="Chia s·∫ª c·∫£m x√∫c c·ªßa b·∫°n..."></textarea>
                            <input type="file" id="forumImage" accept="image/*" class="block w-full text-sm text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100" />
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300">ƒêƒÉng b√†i</button>
                        </form>
                    </div>
                    <!-- Ph·∫ßn l·ªùi khuy√™n t·ª´ chuy√™n gia -->
                    <div id="expertAdviceSection" class="bg-white bg-opacity-20 rounded-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-white">L·ªùi khuy√™n t·ª´ Chuy√™n gia</h3>
                        <div id="expertAdviceContent" class="text-white"></div>
                        <a href="#" id="expertAdviceLink" class="block mt-4 text-blue-300 hover:text-blue-400 transition-colors duration-300" target="_blank">Xem th√™m l·ªùi khuy√™n</a>
                    </div>
                    <!-- Ph·∫ßn h√†nh ƒë·ªông ƒë·ªÅ xu·∫•t -->
                    <div id="actionSection" class="bg-white bg-opacity-20 rounded-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-white">H√†nh ƒë·ªông ƒë·ªÅ xu·∫•t</h3>
                        <ul id="actionList" class="list-disc list-inside text-white space-y-2"></ul>
                    </div>
                    <!-- Ph·∫ßn podcast ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t -->
                    <div id="podcastSection" class="bg-white bg-opacity-20 rounded-lg p-6">
                        <h3 class="text-2xl font-bold mb-4 text-white">Podcast ƒë∆∞·ª£c ƒë·ªÅ xu·∫•t</h3>
                        <div id="podcastContent" class="text-white"></div>
                        <a href="#" id="podcastLink" class="block mt-4 text-blue-300 hover:text-blue-400 transition-colors duration-300" target="_blank">Nghe podcast</a>
                    </div>
                </div>

                <!-- Khu v·ª±c chat -->
                <div id="chatSection" class="bg-white bg-opacity-20 rounded-lg p-6 mt-8">
                    <h3 class="text-2xl font-bold mb-4 text-white">Chat v·ªõi AI</h3>
                    <div id="chatWindow" class="space-y-4 max-h-64 overflow-y-auto">
                        <!-- Tin nh·∫Øn s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                    </div>
                    <form id="chatForm" class="mt-4 flex space-x-2">
                        <input id="chatInput" type="text" class="w-full p-2 rounded-lg" placeholder="Nh·∫≠p tin nh·∫Øn c·ªßa b·∫°n...">
                        <button type="submit" class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg transition-colors duration-300">
                            G·ª≠i
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-16 w-16"></div>
    </div>

    <!-- C·∫£nh b√°o v√† t·ª´ ch·ªëi tr√°ch nhi·ªám -->
    <footer class="mt-8 text-center text-white text-sm">
        <p><strong>L∆∞u √Ω:</strong> Trang web n√†y kh√¥ng thay th·∫ø cho t∆∞ v·∫•n chuy√™n nghi·ªáp. N·∫øu b·∫°n ƒëang g·∫∑p v·∫•n ƒë·ªÅ nghi√™m tr·ªçng v·ªÅ s·ª©c kh·ªèe t√¢m th·∫ßn, h√£y t√¨m ki·∫øm s·ª± gi√∫p ƒë·ª° t·ª´ chuy√™n gia.</p>
    </footer>

    <style>
        /* CSS cho khung chat */
        #chatWindow {
            display: flex;
            flex-direction: column;
        }
        .chat-bubble {
            max-width: 70%;
            word-wrap: break-word;
            margin-bottom: 10px;
        }
        .chat-bubble-self {
            align-self: flex-end;
        }
        .chat-bubble-other {
            align-self: flex-start;
        }

        /* Loading Spinner Styles */
        .loader {
            border-top-color: #3498db;
            animation: spin 1s infinite linear;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>

    <script>
        // C√°c bi·∫øn to√†n c·ª•c
        const emoteButtons = document.querySelectorAll('.emote-btn');
        const emotePage = document.getElementById('emotePage');
        const emoteTitle = document.getElementById('emoteTitle');
        const backButton = document.getElementById('backButton');
        const expertAdviceContent = document.getElementById('expertAdviceContent');
        const podcastContent = document.getElementById('podcastContent');
        const actionList = document.getElementById('actionList');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const chatWindow = document.getElementById('chatWindow');
        let currentEmotion = '';
        let chatHistory = [];

        // B·∫£n ƒë·ªì c·∫£m x√∫c v√† vƒÉn b·∫£n hi·ªÉn th·ªã
        const emoteTexts = {
            happy: 'vui v·∫ª',
            sad: 'bu·ªìn',
            angry: 't·ª©c gi·∫≠n',
            scared: 's·ª£ h√£i',
            stressed: 'cƒÉng th·∫≥ng'
        };

        // H√†m hi·ªÉn th·ªã trang c·∫£m x√∫c
        emoteButtons.forEach(button => {
            button.addEventListener('click', () => {
                const emote = button.getAttribute('data-emote');
                showEmotePage(emote);
            });
        });

        function showEmotePage(emote) {
            currentEmotion = emote;
            document.getElementById('emoteButtons').classList.add('hidden');
            emotePage.classList.remove('hidden');
            backButton.classList.remove('hidden');
            setEmoteTitle(emote);

            // C·∫≠p nh·∫≠t n·ªôi dung d·ª±a tr√™n c·∫£m x√∫c
            updateActionList(emote);
            updateExpertAdvice(emote);
            updatePodcastContent(emote);

            // Kh·ªüi t·∫°o cu·ªôc tr√≤ chuy·ªán v·ªõi AI
            initChatWithAI(emote);
        }

        function setEmoteTitle(emote) {
            emoteTitle.textContent = `B·∫°n ƒëang c·∫£m th·∫•y ${emoteTexts[emote]}`;
        }

        // H√†m c·∫≠p nh·∫≠t danh s√°ch h√†nh ƒë·ªông
        function updateActionList(emote) {
            const actions = {
                happy: [
                    "Chia s·∫ª ni·ªÅm vui v·ªõi ng∆∞·ªùi th√¢n",
                    "Ghi l·∫°i nh·ªØng ƒëi·ªÅu t√≠ch c·ª±c trong nh·∫≠t k√Ω",
                    "Tham gia ho·∫°t ƒë·ªông t√¨nh nguy·ªán"
                ],
                sad: [
                    "Th·ª±c h√†nh thi·ªÅn ƒë·ªãnh 10 ph√∫t",
                    "G·ªçi ƒëi·ªán cho ng∆∞·ªùi b·∫°n th√¢n",
                    "ƒêi d·∫°o trong c√¥ng vi√™n"
                ],
                angry: [
                    "ƒê·∫øm t·ª´ 1 ƒë·∫øn 10 v√† h√≠t th·ªü s√¢u",
                    "Vi·∫øt ra nh·ªØng suy nghƒ© c·ªßa b·∫°n",
                    "T·∫≠p th·ªÉ d·ª•c 15 ph√∫t"
                ],
                scared: [
                    "Th·ª±c h√†nh k·ªπ thu·∫≠t th·ªü 4-7-8",
                    "N√≥i chuy·ªán v·ªõi ng∆∞·ªùi b·∫°n tin t∆∞·ªüng",
                    "T∆∞·ªüng t∆∞·ª£ng m·ªôt n∆°i an to√†n v√† b√¨nh y√™n"
                ],
                stressed: [
                    "Th·ª±c hi·ªán b√†i t·∫≠p th∆∞ gi√£n c∆° b·∫Øp",
                    "L·∫≠p danh s√°ch ∆∞u ti√™n c√¥ng vi·ªác",
                    "Nghe nh·∫°c th∆∞ gi√£n 15 ph√∫t"
                ]
            };

            actionList.innerHTML = actions[emote].map(action => `<li>${action}</li>`).join('');
        }

        // H√†m c·∫≠p nh·∫≠t l·ªùi khuy√™n t·ª´ chuy√™n gia
        function updateExpertAdvice(emote) {
            const advices = {
                happy: "H√£y t·∫≠n h∆∞·ªüng c·∫£m x√∫c t√≠ch c·ª±c n√†y v√† lan t·ªèa n√≥ ƒë·∫øn nh·ªØng ng∆∞·ªùi xung quanh. ƒê√¢y l√† c∆° h·ªôi t·ªët ƒë·ªÉ c·ªßng c·ªë c√°c m·ªëi quan h·ªá v√† t·∫°o ra nh·ªØng k·ª∑ ni·ªám ƒë·∫πp.",
                sad: "C·∫£m gi√°c bu·ªìn b√£ l√† b√¨nh th∆∞·ªùng v√† s·∫Ω qua ƒëi. H√£y cho ph√©p b·∫£n th√¢n c·∫£m nh·∫≠n c·∫£m x√∫c n√†y, nh∆∞ng ƒë·ªìng th·ªùi c≈©ng t√¨m ki·∫øm s·ª± h·ªó tr·ª£ t·ª´ ng∆∞·ªùi th√¢n v√† b·∫°n b√®.",
                angry: "Khi t·ª©c gi·∫≠n, h√£y t·∫°m d·ª´ng v√† suy nghƒ© tr∆∞·ªõc khi h√†nh ƒë·ªông. Th·ª±c h√†nh c√°c k·ªπ thu·∫≠t ki·ªÉm so√°t c∆°n gi·∫≠n nh∆∞ h√≠t th·ªü s√¢u ho·∫∑c ƒë·∫øm ng∆∞·ª£c t·ª´ 10 xu·ªëng 1.",
                scared: "N·ªói s·ª£ c√≥ th·ªÉ khi·∫øn ta c·∫£m th·∫•y b·∫•t l·ª±c, nh∆∞ng h√£y nh·ªõ r·∫±ng b·∫°n m·∫°nh m·∫Ω h∆°n b·∫°n nghƒ©. Chia s·∫ª n·ªói s·ª£ v·ªõi ng∆∞·ªùi kh√°c c√≥ th·ªÉ gi√∫p b·∫°n nh√¨n nh·∫≠n v·∫•n ƒë·ªÅ t·ª´ g√≥c ƒë·ªô kh√°c.",
                stressed: "Stress k√©o d√†i c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn s·ª©c kh·ªèe. H√£y x√°c ƒë·ªãnh ngu·ªìn g·ªëc c·ªßa stress v√† t√¨m c√°ch gi·∫£i quy·∫øt. ƒê·ª´ng qu√™n d√†nh th·ªùi gian cho b·∫£n th√¢n v√† th∆∞ gi√£n."
            };

            expertAdviceContent.textContent = advices[emote];
            expertAdviceLink.href = `https://example.com/${emote}-expert-advice`;
        }

        // H√†m c·∫≠p nh·∫≠t n·ªôi dung podcast
        function updatePodcastContent(emote) {
            const podcasts = {
                happy: "'Ni·ªÅm vui m·ªói ng√†y' - T·∫≠p m·ªõi nh·∫•t v·ªÅ c√°ch duy tr√¨ t√¢m tr·∫°ng t√≠ch c·ª±c",
                sad: "'V∆∞·ª£t qua n·ªói bu·ªìn' - Chia s·∫ª t·ª´ nh·ªØng ng∆∞·ªùi ƒë√£ v∆∞·ª£t qua tr·∫ßm c·∫£m",
                angry: "'Ki·ªÉm so√°t c∆°n gi·∫≠n' - K·ªπ thu·∫≠t qu·∫£n l√Ω c·∫£m x√∫c hi·ªáu qu·∫£",
                scared: "'ƒê·ªëi m·∫∑t v·ªõi n·ªói s·ª£' - C√¢u chuy·ªán truy·ªÅn c·∫£m h·ª©ng v·ªÅ v∆∞·ª£t qua phobia",
                stressed: "'S·ªëng ch·∫≠m l·∫°i' - B√≠ quy·∫øt c√¢n b·∫±ng cu·ªôc s·ªëng trong th·∫ø gi·ªõi h·ªëi h·∫£"
            };

            podcastContent.textContent = podcasts[emote];
            podcastLink.href = "https://www.youtube.com/watch?v=bdK95yNhIP0";
        }

        // H√†m kh·ªüi t·∫°o cu·ªôc tr√≤ chuy·ªán v·ªõi AI
        function initChatWithAI(emote) {
            chatWindow.innerHTML = ''; // X√≥a n·ªôi dung chat tr∆∞·ªõc ƒë√≥
            chatHistory = []; // X√≥a l·ªãch s·ª≠ chat
            addChatBubble(`Xin ch√†o! T√¥i l√† tr·ª£ l√Ω ·∫£o. H√£y chia s·∫ª th√™m v·ªÅ c·∫£m x√∫c ${emoteTexts[emote]} c·ªßa b·∫°n.`, 'other');
        }

        // X·ª≠ l√Ω s·ª± ki·ªán g·ª≠i tin nh·∫Øn
        chatForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (message !== '') {
                addChatBubble(message, 'self');
                chatInput.value = '';
                generateAIResponse(message);
            }
        });

        // H√†m th√™m tin nh·∫Øn v√†o khung chat
        function addChatBubble(message, type) {
            const bubble = document.createElement('div');
            bubble.classList.add('chat-bubble', `chat-bubble-${type}`, 'p-4', 'rounded-xl', 'max-w-xs', 'text-white', 'transition-all', 'duration-300', 'transform', 'hover:scale-105');
            bubble.textContent = message;

            if (type === 'self') {
                bubble.classList.add('bg-green-500');
            } else {
                bubble.classList.add('bg-blue-500');
            }

            chatWindow.appendChild(bubble);
            chatWindow.scrollTop = chatWindow.scrollHeight;

            // L∆∞u v√†o l·ªãch s·ª≠ chat
            chatHistory.push({ message, type });
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        }

        // H√†m t·∫£i l·ªãch s·ª≠ chat
        function loadChatHistory() {
            const savedHistory = localStorage.getItem('chatHistory');
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
                chatHistory.forEach(chat => {
                    addChatBubble(chat.message, chat.type);
                });
            }
        }

        // H√†m t·∫°o ph·∫£n h·ªìi t·ª´ AI
        async function generateAIResponse(userMessage) {
            showLoadingSpinner(); // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng t·∫£i
            try {
                const response = await fetch('http://localhost:3000/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: userMessage,
                        emotion: currentEmotion // G·ª≠i c·∫£m x√∫c hi·ªán t·∫°i
                    })
                });

                const data = await response.json();
                if (data.reply) {
                    addChatBubble(data.reply, 'other');
                } else {
                    addChatBubble('Xin l·ªói, c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau.', 'other');
                }
            } catch (error) {
                console.error(error);
                addChatBubble('Xin l·ªói, kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß.', 'other');
            } finally {
                hideLoadingSpinner(); // ·∫®n bi·ªÉu t∆∞·ª£ng t·∫£i
            }
        }

        // H√†m hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng t·∫£i
        function showLoadingSpinner() {
            document.getElementById('loadingSpinner').classList.remove('hidden');
        }

        // H√†m ·∫©n bi·ªÉu t∆∞·ª£ng t·∫£i
        function hideLoadingSpinner() {
            document.getElementById('loadingSpinner').classList.add('hidden');
        }

        // X·ª≠ l√Ω n√∫t quay l·∫°i
        backButton.addEventListener('click', () => {
            document.getElementById('emoteButtons').classList.remove('hidden');
            emotePage.classList.add('hidden');
            backButton.classList.add('hidden');
            localStorage.removeItem('chatHistory'); // X√≥a l·ªãch s·ª≠ chat khi quay l·∫°i
        });

        // X·ª≠ l√Ω g·ª≠i b√†i vi·∫øt tr√™n di·ªÖn ƒë√†n
        document.getElementById('forumForm').addEventListener('submit', function(e) {
            e.preventDefault();
            showLoadingSpinner(); // Hi·ªÉn th·ªã bi·ªÉu t∆∞·ª£ng t·∫£i
            setTimeout(() => {
                hideLoadingSpinner(); // ·∫®n bi·ªÉu t∆∞·ª£ng t·∫£i
                alert('B√†i vi·∫øt c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c ƒëƒÉng th√†nh c√¥ng!');
                this.reset();
            }, 1000);
        });

        // H·ªó tr·ª£ emoji trong khung chat
        chatInput.addEventListener('input', function() {
            // Thay th·∫ø k√Ω hi·ªáu b·∫±ng emoji
            const emojiMap = {
                ':)': 'üòä',
                ':(': 'üò¢',
                ':D': 'üòÑ',
                '<3': '‚ù§Ô∏è'
            };
            for (const [key, value] of Object.entries(emojiMap)) {
                this.value = this.value.replace(new RegExp(`\\${key}`, 'g'), value);
            }
        });
    </script>
</body>
</html>